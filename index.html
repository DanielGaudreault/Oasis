<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The OASIS - Open World Experience</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css">
    <style>
        /* loading.css */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease-out;
        }
        
        .loading-logo {
            font-size: 4rem;
            font-weight: bold;
            color: #0ff;
            text-shadow: 0 0 10px #0ff, 0 0 20px #0ff, 0 0 30px #0ff;
            margin-bottom: 2rem;
            letter-spacing: 0.5rem;
            animation: pulse 2s infinite;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 8px solid #0ff;
            animation: spin 1s linear infinite;
        }
        
        .loading-progress {
            width: 300px;
            height: 10px;
            background-color: rgba(0, 255, 255, 0.1);
            margin-top: 20px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .loading-progress-bar {
            height: 100%;
            width: 0%;
            background-color: #0ff;
            box-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
            transition: width 0.5s;
        }
        
        .loading-text {
            color: #0ff;
            margin-top: 20px;
            font-size: 1.2rem;
            text-shadow: 0 0 5px #0ff;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        /* style.css */
        :root {
            --primary-color: #0ff;
            --secondary-color: #f0f;
            --tertiary-color: #ff0;
            --background-color: #000;
            --ui-background: rgba(0, 10, 20, 0.8);
            --ui-border: rgba(0, 255, 255, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Rajdhani', sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: relative;
        }
        
        /* Login Screen */
        #login-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #001a2c 0%, #000000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease-out;
        }
        
        .login-container {
            background-color: var(--ui-background);
            border: 2px solid var(--ui-border);
            border-radius: 10px;
            padding: 40px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                to bottom,
                transparent,
                transparent 4px,
                rgba(0, 255, 255, 0.05) 4px,
                rgba(0, 255, 255, 0.05) 8px
            );
            pointer-events: none;
            z-index: -1;
            animation: scanline 8s linear infinite;
        }
        
        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100px); }
        }
        
        .login-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--primary-color);
        }
        
        .login-subtitle {
            font-size: 1rem;
            color: #fff;
            margin-bottom: 30px;
            opacity: 0.8;
        }
        
        .login-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--primary-color);
            border-radius: 5px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }
        
        .login-input:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.3);
        }
        
        .login-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 5px;
            color: #000;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .login-button:hover {
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
        }
        
        .login-options {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .login-options a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .login-options a:hover {
            text-shadow: 0 0 5px var(--primary-color);
        }
        
        /* Main Game UI */
        .game-container {
            width: 100%;
            height: 100%;
            position: relative;
            display: none;
        }
        
        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .ui-element {
            pointer-events: auto;
        }
        
        .ui-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .player-info {
            background-color: var(--ui-background);
            border: 1px solid var(--ui-border);
            border-radius: 50px;
            padding: 5px 15px;
            display: flex;
            align-items: center;
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            margin-right: 10px;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
        }
        
        .player-level {
            background-color: var(--primary-color);
            color: black;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .world-info {
            background-color: var(--ui-background);
            border: 1px solid var(--ui-border);
            border-radius: 50px;
            padding: 5px 15px;
            display: flex;
            align-items: center;
        }
        
        .world-name {
            font-weight: bold;
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .world-status {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .ui-mini-map {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 200px;
            background-color: var(--ui-background);
            border: 1px solid var(--ui-border);
            border-radius: 5px;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .ui-mini-map:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }
        
        .mini-map-canvas {
            width: 100%;
            height: 100%;
        }
        
        .ui-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .control-group {
            background-color: var(--ui-background);
            border: 1px solid var(--ui-border);
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .control-title {
            font-size: 0.8rem;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .control-keys {
            display: flex;
            gap: 5px;
        }
        
        .key {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            padding: 2px 5px;
            font-size: 0.8rem;
        }
        
        .ui-inventory {
            position: absolute;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            background-color: var(--ui-background);
            border: 1px solid var(--ui-border);
            border-radius: 5px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .inventory-slot {
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: var(--primary-color);
            transition: all 0.2s;
        }
        
        .inventory-slot:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .inventory-slot.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
        }
        
        .ui-interaction {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--ui-background);
            border: 1px solid var(--ui-border);
            border-radius: 50px;
            padding: 10px 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .interaction-key {
            background-color: var(--primary-color);
            color: black;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        
        .travel-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--ui-background);
            border: 2px solid var(--ui-border);
            border-radius: 10px;
            padding: 30px;
            width: 70%;
            max-width: 800px;
            display: none;
            z-index: 100;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }
        
        .travel-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--ui-border);
        }
        
        .travel-modal-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            text-shadow: 0 0 5px var(--primary-color);
        }
        
        .travel-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .travel-modal-close:hover {
            color: var(--secondary-color);
            transform: scale(1.2);
        }
        
        .travel-destinations {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .destination-card {
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--ui-border);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .destination-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .destination-image {
            width: 100%;
            height: 120px;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            border-bottom: 1px solid var(--ui-border);
        }
        
        .destination-info {
            padding: 15px;
        }
        
        .destination-name {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .destination-desc {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .destination-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
        }
        
        .destination-travel {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            border-radius: 5px;
            color: black;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .destination-travel:hover {
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .world-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 50;
            display: none;
        }
        
        /* Mobile Controls */
        .mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            z-index: 20;
        }
        
        .joystick-container {
            width: 150px;
            height: 150px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            position: relative;
        }
        
        .joystick {
            width: 50px;
            height: 50px;
            background-color: var(--primary-color);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .action-buttons {
            position: absolute;
            right: -100px;
            bottom: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .action-button {
            width: 60px;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5rem;
        }
        
        /* Custom Animations */
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        
        .glitch {
            animation: glitch 0.3s linear infinite;
            animation-play-state: paused;
        }
        
        .glitch:hover {
            animation-play-state: running;
        }
        
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0); }
        }
        
        .float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* World specific styles */
        .race-track {
            --primary-color: #ff0000;
            --secondary-color: #ff6600;
        }
        
        .social-hub {
            --primary-color: #00ffcc;
            --secondary-color: #00ccff;
        }
        
        .arcade-zone {
            --primary-color: #ff00ff;
            --secondary-color: #aa00ff;
        }
        
        /* Particle animation */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        /* Chat system */
        .chat-container {
            position: absolute;
            bottom: 20px;
            left: 250px;
            width: 300px;
            background-color: var(--ui-background);
            border: 1px solid var(--ui-border);
            border-radius: 5px;
            display: none;
            flex-direction: column;
            max-height: 300px;
            z-index: 30;
        }
        
        .chat-messages {
            padding: 10px;
            overflow-y: auto;
            max-height: 250px;
        }
        
        .chat-message {
            margin-bottom: 8px;
            animation: fade-in 0.3s;
        }
        
        .chat-user {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .chat-input-container {
            display: flex;
            border-top: 1px solid var(--ui-border);
        }
        
        .chat-input {
            flex-grow: 1;
            background-color: rgba(0, 0, 0, 0.3);
            border: none;
            padding: 8px;
            color: white;
            outline: none;
        }
        
        .chat-send {
            background-color: var(--primary-color);
            border: none;
            color: black;
            padding: 8px 12px;
            cursor: pointer;
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Avatar creation */
        .avatar-creator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--ui-background);
            border: 2px solid var(--ui-border);
            border-radius: 10px;
            padding: 30px;
            width: 80%;
            max-width: 800px;
            display: none;
            z-index: 100;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }
        
        .avatar-creator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--ui-border);
        }
        
        .avatar-creator-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            text-shadow: 0 0 5px var(--primary-color);
        }
        
        .avatar-creator-body {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .avatar-preview {
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
        }
        
        .avatar-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .avatar-option-group {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 10px;
        }
        
        .avatar-option-title {
            font-size: 1rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .avatar-option-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .avatar-option-item {
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .avatar-option-item:hover, .avatar-option-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: var(--primary-color);
            transform: scale(1.1);
        }
        
        .avatar-creator-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid var(--ui-border);
        }
        
        .avatar-random {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .avatar-random:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: var(--primary-color);
        }
        
        .avatar-save {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 5px;
            padding: 8px 20px;
            color: black;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .avatar-save:hover {
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
        }
        
        /* PDF export optimization */
        @media print {
            body {
                overflow: visible;
                height: auto;
            }
            
            .loading-container, #login-screen, .ui-container {
                display: none !important;
            }
            
            .game-container {
                display: block !important;
                position: static;
                height: auto;
            }
            
            #game-canvas {
                position: static;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-container" id="loading-screen">
        <div class="loading-logo">OASIS</div>
        <div class="loading-spinner"></div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loading-bar"></div>
        </div>
        <div class="loading-text" id="loading-text">Initializing OASIS systems...</div>
    </div>
    
    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-container">
            <h1 class="login-title">OASIS</h1>
            <p class="login-subtitle">Welcome to the world of infinite possibilities</p>
            <input type="text" class="login-input" placeholder="Username" id="username-input">
            <input type="password" class="login-input" placeholder="Password" id="password-input">
            <button class="login-button" id="login-button">ACCESS THE OASIS</button>
            <div class="login-options">
                <span>New user? <a href="#" id="create-avatar-link">Create Avatar</a></span>
                <a href="#">Help</a>
            </div>
        </div>
    </div>
    
    <!-- Avatar Creator -->
    <div class="avatar-creator" id="avatar-creator">
        <div class="avatar-creator-header">
            <h2 class="avatar-creator-title">Create Your Avatar</h2>
            <button class="avatar-creator-close" id="avatar-creator-close">×</button>
        </div>
        <div class="avatar-creator-body">
            <div class="avatar-preview">
                <canvas id="avatar-preview-canvas" width="250" height="300"></canvas>
            </div>
            <div class="avatar-options">
                <div class="avatar-option-group">
                    <h3 class="avatar-option-title">Body Type</h3>
                    <div class="avatar-option-items">
                        <div class="avatar-option-item body-type" data-type="human" title="Human"><i class="fas fa-user"></i></div>
                        <div class="avatar-option-item body-type" data-type="robot" title="Robot"><i class="fas fa-robot"></i></div>
                        <div class="avatar-option-item body-type" data-type="alien" title="Alien"><i class="fas fa-user-astronaut"></i></div>
                        <div class="avatar-option-item body-type" data-type="fantasy" title="Fantasy"><i class="fas fa-hat-wizard"></i></div>
                    </div>
                </div>
                <div class="avatar-option-group">
                    <h3 class="avatar-option-title">Skin Tone</h3>
                    <div class="avatar-option-items">
                        <div class="avatar-option-item skin-tone" data-color="#FFDBAC" style="background-color: #FFDBAC;"></div>
                        <div class="avatar-option-item skin-tone" data-color="#F1C27D" style="background-color: #F1C27D;"></div>
                        <div class="avatar-option-item skin-tone" data-color="#E0AC69" style="background-color: #E0AC69;"></div>
                        <div class="avatar-option-item skin-tone" data-color="#C68642" style="background-color: #C68642;"></div>
                        <div class="avatar-option-item skin-tone" data-color="#8D5524" style="background-color: #8D5524;"></div>
                        <div class="avatar-option-item skin-tone" data-color="#33A0FF" style="background-color: #33A0FF;"></div>
                        <div class="avatar-option-item skin-tone" data-color="#7ED957" style="background-color: #7ED957;"></div>
                        <div class="avatar-option-item skin-tone" data-color="#B026FF" style="background-color: #B026FF;"></div>
                    </div>
                </div>
                <div class="avatar-option-group">
                    <h3 class="avatar-option-title">Hair Style</h3>
                    <div class="avatar-option-items">
                        <div class="avatar-option-item hair-style" data-style="short" title="Short"><i class="fas fa-user"></i></div>
                        <div class="avatar-option-item hair-style" data-style="long" title="Long"><i class="fas fa-user-tie"></i></div>
                        <div class="avatar-option-item hair-style" data-style="ponytail" title="Ponytail"><i class="fas fa-user-ninja"></i></div>
                        <div class="avatar-option-item hair-style" data-style="bald" title="Bald"><i class="fas fa-user-alt"></i></div>
                        <div class="avatar-option-item hair-style" data-style="mohawk" title="Mohawk"><i class="fas fa-user-secret"></i></div>
                    </div>
                </div>
                <div class="avatar-option-group">
                    <h3 class="avatar-option-title">Outfit</h3>
                    <div class="avatar-option-items">
                        <div class="avatar-option-item outfit" data-outfit="casual" title="Casual"><i class="fas fa-tshirt"></i></div>
                        <div class="avatar-option-item outfit" data-outfit="formal" title="Formal"><i class="fas fa-user-tie"></i></div>
                        <div class="avatar-option-item outfit" data-outfit="warrior" title="Warrior"><i class="fas fa-shield-alt"></i></div>
                        <div class="avatar-option-item outfit" data-outfit="sci-fi" title="Sci-Fi"><i class="fas fa-space-shuttle"></i></div>
                        <div class="avatar-option-item outfit" data-outfit="stealth" title="Stealth"><i class="fas fa-user-ninja"></i></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="avatar-creator-footer">
            <button class="avatar-random" id="avatar-random">Randomize</button>
            <button class="avatar-save" id="avatar-save">Save & Continue</button>
        </div>
    </div>
    
    <!-- Main Game -->
    <div class="game-container" id="game-container">
        <canvas id="game-canvas"></canvas>
        <div class="particles" id="particles"></div>
        
        <!-- UI Overlay -->
        <div class="ui-container">
            <div class="ui-header">
                <div class="player-info ui-element">
                    <div class="player-avatar" id="player-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="player-name" id="player-name">Player1</div>
                    <div class="player-level">10</div>
                </div>
                <div class="world-info ui-element">
                    <div class="world-name" id="world-name">Central OASIS</div>
                    <div class="world-status">Online Users: <span id="online-users">1,254</span></div>
                </div>
            </div>
            
            <div class="ui-controls ui-element">
                <div class="control-group">
                    <div class="control-title">Movement</div>
                    <div class="control-keys">
                        <div class="key">W</div>
                        <div class="key">A</div>
                        <div class="key">S</div>
                        <div class="key">D</div>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-title">Actions</div>
                    <div class="control-keys">
                        <div class="key">E</div>
                        <div class="key">Space</div>
                        <div class="key">Shift</div>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-title">Menu</div>
                    <div class="control-keys">
                        <div class="key">Tab</div>
                        <div class="key">M</div>
                        <div class="key">T</div>
                    </div>
                </div>
            </div>
            
            <div class="ui-inventory ui-element">
                <div class="inventory-slot" title="Travel Pass">
                    <i class="fas fa-ticket-alt"></i>
                </div>
                <div class="inventory-slot" title="Communication Device">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="inventory-slot active" title="Game Controller">
                    <i class="fas fa-gamepad"></i>
                </div>
                <div class="inventory-slot" title="Virtual Currency">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="inventory-slot" title="Power-Up">
                    <i class="fas fa-bolt"></i>
                </div>
            </div>
            
            <div class="ui-mini-map ui-element">
                <canvas class="mini-map-canvas" id="mini-map"></canvas>
            </div>
            
            <div class="ui-interaction ui-element" id="interaction-prompt">
                <div class="interaction-key">E</div>
                <div class="interaction-text">Travel to Another World</div>
            </div>
            
            <div class="chat-container ui-element" id="chat-container">
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-message">
                        <span class="chat-user">System:</span> Welcome to the OASIS!
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chat-input" placeholder="Type a message...">
                    <button class="chat-send" id="chat-send"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
            
            <div class="mobile-controls ui-element" id="mobile-controls">
                <div class="joystick-container">
                    <div class="joystick" id="joystick"></div>
                </div>
                <div class="action-buttons">
                    <div class="action-button"><i class="fas fa-hand-pointer"></i></div>
                    <div class="action-button"><i class="fas fa-running"></i></div>
                    <div class="action-button"><i class="fas fa-comments"></i></div>
                    <div class="action-button"><i class="fas fa-bars"></i></div>
                </div>
            </div>
        </div>
        
        <!-- World Travel Modal -->
        <div class="travel-modal" id="travel-modal">
            <div class="travel-modal-header">
                <h2 class="travel-modal-title">Travel to Another World</h2>
                <button class="travel-modal-close" id="travel-modal-close">×</button>
            </div>
            <div class="travel-destinations">
                <div class="destination-card" data-world="race-track">
                    <div class="destination-image">
                        <i class="fas fa-flag-checkered" style="color: #ff0000;"></i>
                    </div>
                    <div class="destination-info">
                        <h3 class="destination-name">The Race Track</h3>
                        <p class="destination-desc">High-speed racing on deadly tracks</p>
                        <div class="destination-stats">
                            <span>Difficulty: High</span>
                            <span>Players: 128</span>
                        </div>
                        <button class="destination-travel">TRAVEL</button>
                    </div>
                </div>
                <div class="destination-card" data-world="social-hub">
                    <div class="destination-image">
                        <i class="fas fa-users" style="color: #00ffcc;"></i>
                    </div>
                    <div class="destination-info">
                        <h3 class="destination-name">Social Hub</h3>
                        <p class="destination-desc">Meet other players and socialize</p>
                        <div class="destination-stats">
                            <span>Difficulty: Low</span>
                            <span>Players: 543</span>
                        </div>
                        <button class="destination-travel">TRAVEL</button>
                    </div>
                </div>
                <div class="destination-card" data-world="arcade-zone">
                    <div class="destination-image">
                        <i class="fas fa-gamepad" style="color: #ff00ff;"></i>
                    </div>
                    <div class="destination-info">
                        <h3 class="destination-name">Arcade Zone</h3>
                        <p class="destination-desc">Classic and modern arcade games</p>
                        <div class="destination-stats">
                            <span>Difficulty: Medium</span>
                            <span>Players: 321</span>
                        </div>
                        <button class="destination-travel">TRAVEL</button>
                    </div>
                </div>
                <div class="destination-card" data-world="battle-arena">
                    <div class="destination-image">
                        <i class="fas fa-fist-raised" style="color: #ffcc00;"></i>
                    </div>
                    <div class="destination-info">
                        <h3 class="destination-name">Battle Arena</h3>
                        <p class="destination-desc">PvP combat and tournaments</p>
                        <div class="destination-stats">
                            <span>Difficulty: Extreme</span>
                            <span>Players: 207</span>
                        </div>
                        <button class="destination-travel">TRAVEL</button>
                    </div>
                </div>
                <div class="destination-card" data-world="fantasy-realm">
                    <div class="destination-image">
                        <i class="fas fa-dragon" style="color: #66ff66;"></i>
                    </div>
                    <div class="destination-info">
                        <h3 class="destination-name">Fantasy Realm</h3>
                        <p class="destination-desc">Medieval fantasy world with quests</p>
                        <div class="destination-stats">
                            <span>Difficulty: Medium</span>
                            <span>Players: 412</span>
                        </div>
                        <button class="destination-travel">TRAVEL</button>
                    </div>
                </div>
                <div class="destination-card" data-world="space-sector">
                    <div class="destination-image">
                        <i class="fas fa-rocket" style="color: #33ccff;"></i>
                    </div>
                    <div class="destination-info">
                        <h3 class="destination-name">Space Sector</h3>
                        <p class="destination-desc">Explore distant planets and galaxies</p>
                        <div class="destination-stats">
                            <span>Difficulty: High</span>
                            <span>Players: 156</span>
                        </div>
                        <button class="destination-travel">TRAVEL</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="world-overlay" id="world-overlay"></div>
    </div>
    
    <script>
        // main.js - Main application entry point
        const OASIS = {
            debug: false,
            currentWorld: 'central',
            assetsLoaded: 0,
            totalAssets: 10,
            player: {
                username: 'Guest',
                avatar: {
                    type: 'human',
                    skinTone: '#E0AC69',
                    hairStyle: 'short',
                    outfit: 'casual'
                },
                position: { x: 0, y: 0 },
                velocity: { x: 0, y: 0 },
                direction: 0,
                speed: 5,
                level: 10,
                inventory: ['travel-pass', 'comm-device', 'game-controller', 'currency', 'power-up']
            },
            worlds: {},
            ui: null,
            worldManager: null,
            avatarSystem: null,
            canvas: null,
            ctx: null,
            keys: {},
            npcs: [],
            gameLoop: null,
            lastTime: 0,
            mousePosition: { x: 0, y: 0 },
            
            // Initialize the application
            init: function() {
                this.simulateLoading();
                
                // Set up login handlers
                document.getElementById('login-button').addEventListener('click', this.handleLogin.bind(this));
                document.getElementById('create-avatar-link').addEventListener('click', this.showAvatarCreator.bind(this));
                document.getElementById('avatar-creator-close').addEventListener('click', this.hideAvatarCreator.bind(this));
                document.getElementById('avatar-random').addEventListener('click', this.randomizeAvatar.bind(this));
                document.getElementById('avatar-save').addEventListener('click', this.saveAvatar.bind(this));
                
                // Initialize UI
                this.ui = new UIManager(this);
                this.ui.init();
                
                // Initialize world manager
                this.worldManager = new WorldManager(this);
                this.avatarSystem = new AvatarSystem(this);
                
                // Set up avatar creator options
                document.querySelectorAll('.body-type').forEach(item => {
                    item.addEventListener('click', e => {
                        document.querySelectorAll('.body-type').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        this.player.avatar.type = item.dataset.type;
                        this.avatarSystem.updateAvatarPreview();
                    });
                });
                
                document.querySelectorAll('.skin-tone').forEach(item => {
                    item.addEventListener('click', e => {
                        document.querySelectorAll('.skin-tone').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        this.player.avatar.skinTone = item.dataset.color;
                        this.avatarSystem.updateAvatarPreview();
                    });
                });
                
                document.querySelectorAll('.hair-style').forEach(item => {
                    item.addEventListener('click', e => {
                        document.querySelectorAll('.hair-style').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        this.player.avatar.hairStyle = item.dataset.style;
                        this.avatarSystem.updateAvatarPreview();
                    });
                });
                
                document.querySelectorAll('.outfit').forEach(item => {
                    item.addEventListener('click', e => {
                        document.querySelectorAll('.outfit').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        this.player.avatar.outfit = item.dataset.outfit;
                        this.avatarSystem.updateAvatarPreview();
                    });
                });
                
                // Add global event listeners
                window.addEventListener('keydown', e => { this.keys[e.key.toLowerCase()] = true; });
                window.addEventListener('keyup', e => { this.keys[e.key.toLowerCase()] = false; });
                
                window.addEventListener('keydown', e => {
                    if (e.key.toLowerCase() === 't' && this.gameStarted) {
                        this.ui.toggleChat();
                    }
                    if (e.key.toLowerCase() === 'm' && this.gameStarted) {
                        this.ui.toggleTravelModal();
                    }
                });
                
                // Set up travel modal
                document.getElementById('travel-modal-close').addEventListener('click', () => {
                    document.getElementById('travel-modal').style.display = 'none';
                    document.getElementById('world-overlay').style.display = 'none';
                });
                
                document.querySelectorAll('.destination-travel').forEach(button => {
                    button.addEventListener('click', e => {
                        const worldId = e.target.closest('.destination-card').dataset.world;
                        this.worldManager.travelToWorld(worldId);
                        document.getElementById('travel-modal').style.display = 'none';
                        document.getElementById('world-overlay').style.display = 'none';
                    });
                });
                
                // Initialize the canvas
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.resizeCanvas();
                window.addEventListener('resize', this.resizeCanvas.bind(this));
                
                // Initialize chat
                document.getElementById('chat-send').addEventListener('click', this.sendChatMessage.bind(this));
                document.getElementById('chat-input').addEventListener('keypress', e => {
                    if (e.key === 'Enter') {
                        this.sendChatMessage();
                    }
                });
                
                // Track mouse position for interactions
                this.canvas.addEventListener('mousemove', e => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mousePosition = {
                        x: e.clientX - rect.left,
                        y: e.clientY - rect.top
                    };
                });
                
                // Mobile controls detection
                this.checkForMobile();
                
                // Initialize mini-map
                this.miniMap = document.getElementById('mini-map');
                this.miniMapCtx = this.miniMap.getContext('2d');
            },
            
            simulateLoading: function() {
                const loadingBar = document.getElementById('loading-bar');
                const loadingText = document.getElementById('loading-text');
                
                const loadingMessages = [
                    'Initializing OASIS systems...',
                    'Connecting to virtual network...',
                    'Loading world data...',
                    'Calibrating sensory input...',
                    'Generating environments...',
                    'Synchronizing user profiles...',
                    'Optimizing rendering engine...',
                    'Establishing secure connection...',
                    'Preparing avatar systems...',
                    'Ready to enter the OASIS!'
                ];
                
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 10;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                        setTimeout(() => {
                            document.getElementById('loading-screen').style.opacity = '0';
                            setTimeout(() => {
                                document.getElementById('loading-screen').style.display = 'none';
                            }, 1000);
                        }, 500);
                    }
                    
                    const messageIndex = Math.min(Math.floor(progress / 10), 9);
                    loadingText.textContent = loadingMessages[messageIndex];
                    loadingBar.style.width = `${progress}%`;
                }, 200);
            },
            
            handleLogin: function() {
                const username = document.getElementById('username-input').value || 'Player1';
                this.player.username = username;
                document.getElementById('player-name').textContent = username;
                
                // Hide login screen
                document.getElementById('login-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('login-screen').style.display = 'none';
                    this.startGame();
                }, 1000);
            },
            
            showAvatarCreator: function() {
                document.getElementById('avatar-creator').style.display = 'block';
                this.avatarSystem.initAvatarCreator();
            },
            
            hideAvatarCreator: function() {
                document.getElementById('avatar-creator').style.display = 'none';
            },
            
            randomizeAvatar: function() {
                const types = ['human', 'robot', 'alien', 'fantasy'];
                const skinTones = ['#FFDBAC', '#F1C27D', '#E0AC69', '#C68642', '#8D5524', '#33A0FF', '#7ED957', '#B026FF'];
                const hairStyles = ['short', 'long', 'ponytail', 'bald', 'mohawk'];
                const outfits = ['casual', 'formal', 'warrior', 'sci-fi', 'stealth'];
                
                this.player.avatar.type = types[Math.floor(Math.random() * types.length)];
                this.player.avatar.skinTone = skinTones[Math.floor(Math.random() * skinTones.length)];
                this.player.avatar.hairStyle = hairStyles[Math.floor(Math.random() * hairStyles.length)];
                this.player.avatar.outfit = outfits[Math.floor(Math.random() * outfits.length)];
                
                // Update UI
                document.querySelectorAll('.body-type').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.type === this.player.avatar.type) {
                        item.classList.add('active');
                    }
                });
                
                document.querySelectorAll('.skin-tone').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.color === this.player.avatar.skinTone) {
                        item.classList.add('active');
                    }
                });
                
                document.querySelectorAll('.hair-style').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.style === this.player.avatar.hairStyle) {
                        item.classList.add('active');
                    }
                });
                
                document.querySelectorAll('.outfit').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.outfit === this.player.avatar.outfit) {
                        item.classList.add('active');
                    }
                });
                
                this.avatarSystem.updateAvatarPreview();
            },
            
            saveAvatar: function() {
                this.hideAvatarCreator();
                this.avatarSystem.updatePlayerAvatar();
                document.getElementById('login-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('login-screen').style.display = 'none';
                    this.startGame();
                }, 1000);
            },
            
            startGame: function() {
                this.gameStarted = true;
                document.getElementById('game-container').style.display = 'block';
                
                // Initialize worlds
                this.worlds.central = new CentralWorld(this);
                this.worlds['race-track'] = new RaceTrack(this);
                this.worlds['social-hub'] = new SocialHub(this);
                this.worlds['arcade-zone'] = new ArcadeZone(this);
                
                // Set initial position
                this.player.position = { x: this.canvas.width / 2, y: this.canvas.height / 2 };
                
                // Generate NPCs
                this.generateNPCs();
                
                // Start game loop
                this.lastTime = performance.now();
                this.gameLoop = requestAnimationFrame(this.update.bind(this));
                
                // Add chat notification
                this.addChatMessage('System', 'Welcome to the OASIS! Press M to open the travel menu, T to open chat.');
                
                // Show interaction prompt after a delay
                setTimeout(() => {
                    document.getElementById('interaction-prompt').style.display = 'flex';
                    setTimeout(() => {
                        document.getElementById('interaction-prompt').style.display = 'none';
                    }, 5000);
                }, 3000);
            },
            
            update: function(timestamp) {
                // Calculate delta time
                const deltaTime = (timestamp - this.lastTime) / 1000;
                this.lastTime = timestamp;
                
                // Clear canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Handle player movement
                this.handlePlayerMovement(deltaTime);
                
                // Update current world
                if (this.worlds[this.currentWorld]) {
                    this.worlds[this.currentWorld].update(deltaTime);
                    this.worlds[this.currentWorld].render(this.ctx);
                }
                
                // Draw player
                this.drawPlayer();
                
                // Draw NPCs
                this.drawNPCs();
                
                // Update UI
                this.ui.update(deltaTime);
                
                // Draw mini-map
                this.drawMiniMap();
                
                // Check for interactions
                this.checkInteractions();
                
                // Continue game loop
                this.gameLoop = requestAnimationFrame(this.update.bind(this));
            },
            
            handlePlayerMovement: function(deltaTime) {
                // Reset velocity
                this.player.velocity = { x: 0, y: 0 };
                
                // Apply movement based on key presses
                if (this.keys['w']) this.player.velocity.y = -this.player.speed;
                if (this.keys['s']) this.player.velocity.y = this.player.speed;
                if (this.keys['a']) this.player.velocity.x = -this.player.speed;
                if (this.keys['d']) this.player.velocity.x = this.player.speed;
                
                // Normalize diagonal movement
                if (this.player.velocity.x !== 0 && this.player.velocity.y !== 0) {
                    const length = Math.sqrt(this.player.velocity.x * this.player.velocity.x + this.player.velocity.y * this.player.velocity.y);
                    this.player.velocity.x = (this.player.velocity.x / length) * this.player.speed;
                    this.player.velocity.y = (this.player.velocity.y / length) * this.player.speed;
                }
                
                // Set direction based on movement
                if (this.player.velocity.x !== 0 || this.player.velocity.y !== 0) {
                    this.player.direction = Math.atan2(this.player.velocity.y, this.player.velocity.x);
                }
                
                // Update position
                this.player.position.x += this.player.velocity.x * deltaTime * 60;
                this.player.position.y += this.player.velocity.y * deltaTime * 60;
                
                // Boundary checking
                const padding = 50;
                if (this.player.position.x < padding) this.player.position.x = padding;
                if (this.player.position.y < padding) this.player.position.y = padding;
                if (this.player.position.x > this.canvas.width - padding) this.player.position.x = this.canvas.width - padding;
                if (this.player.position.y > this.canvas.height - padding) this.player.position.y = this.canvas.height - padding;
            },
            
            drawPlayer: function() {
                this.ctx.save();
                this.ctx.translate(this.player.position.x, this.player.position.y);
                this.ctx.rotate(this.player.direction);
                
                // Draw avatar base
                this.ctx.beginPath();
                this.ctx.arc(0, 0, 20, 0, Math.PI * 2);
                this.ctx.fillStyle = this.player.avatar.skinTone;
                this.ctx.fill();
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // Draw outfit (simplified)
                this.ctx.beginPath();
                this.ctx.arc(0, 0, 15, -0.5 * Math.PI, 0.5 * Math.PI);
                
                // Different outfit colors based on type
                let outfitColor;
                switch(this.player.avatar.outfit) {
                    case 'casual': outfitColor = '#3366ff'; break;
                    case 'formal': outfitColor = '#000000'; break;
                    case 'warrior': outfitColor = '#993300'; break;
                    case 'sci-fi': outfitColor = '#33ccff'; break;
                    case 'stealth': outfitColor = '#333333'; break;
                    default: outfitColor = '#3366ff';
                }
                
                this.ctx.fillStyle = outfitColor;
                this.ctx.fill();
                
                // Draw direction indicator
                this.ctx.beginPath();
                this.ctx.moveTo(15, 0);
                this.ctx.lineTo(25, 0);
                this.ctx.strokeStyle = 'white';
                this.ctx.lineWidth = 3;
                this.ctx.stroke();
                
                // Draw glow effect
                this.ctx.beginPath();
                this.ctx.arc(0, 0, 25, 0, Math.PI * 2);
                this.ctx.strokeStyle = 'rgba(0, 255, 255, 0.5)';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // Draw username above avatar
                this.ctx.rotate(-this.player.direction); // Undo rotation for text
                this.ctx.fillStyle = 'white';
                this.ctx.font = '14px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(this.player.username, 0, -30);
                
                this.ctx.restore();
            },
            
            generateNPCs: function() {
                // Generate random NPCs for the world
                const npcCount = 20;
                const names = ['Aech', 'Art3mis', 'Parzival', 'Daito', 'Shoto', 'i-R0k', 'Phoenix', 'Nebula', 'Quantum', 'Zero'];
                const types = ['human', 'robot', 'alien', 'fantasy'];
                const skinTones = ['#FFDBAC', '#F1C27D', '#E0AC69', '#C68642', '#8D5524', '#33A0FF', '#7ED957', '#B026FF'];
                
                for (let i = 0; i < npcCount; i++) {
                    const npc = {
                        username: names[Math.floor(Math.random() * names.length)] + Math.floor(Math.random() * 100),
                        avatar: {
                            type: types[Math.floor(Math.random() * types.length)],
                            skinTone: skinTones[Math.floor(Math.random() * skinTones.length)]
                        },
                        position: {
                            x: Math.random() * this.canvas.width,
                            y: Math.random() * this.canvas.height
                        },
                        direction: Math.random() * Math.PI * 2,
                        velocity: { x: 0, y: 0 },
                        speed: 1 + Math.random() * 2,
                        targetPosition: {
                            x: Math.random() * this.canvas.width,
                            y: Math.random() * this.canvas.height
                        },
                        lastTargetChange: 0,
                        interactionType: Math.random() > 0.7 ? 'travel' : (Math.random() > 0.5 ? 'chat' : 'none')
                    };
                    
                    this.npcs.push(npc);
                }
            },
            
            drawNPCs: function() {
                const currentTime = performance.now();
                
                this.npcs.forEach(npc => {
                    // Update NPC behavior
                    if (currentTime - npc.lastTargetChange > 5000) {
                        npc.targetPosition = {
                            x: Math.random() * this.canvas.width,
                            y: Math.random() * this.canvas.height
                        };
                        npc.lastTargetChange = currentTime;
                    }
                    
                    // Calculate direction to target
                    const dx = npc.targetPosition.x - npc.position.x;
                    const dy = npc.targetPosition.y - npc.position.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 5) {
                        npc.direction = Math.atan2(dy, dx);
                        npc.velocity.x = Math.cos(npc.direction) * npc.speed;
                        npc.velocity.y = Math.sin(npc.direction) * npc.speed;
                        
                        npc.position.x += npc.velocity.x;
                        npc.position.y += npc.velocity.y;
                    }
                    
                    // Draw NPC
                    this.ctx.save();
                    this.ctx.translate(npc.position.x, npc.position.y);
                    this.ctx.rotate(npc.direction);
                    
                    // Draw avatar base
                    this.ctx.beginPath();
                    this.ctx.arc(0, 0, 20, 0, Math.PI * 2);
                    this.ctx.fillStyle = npc.avatar.skinTone;
                    this.ctx.fill();
                    this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                    
                    // Draw direction indicator
                    this.ctx.beginPath();
                    this.ctx.moveTo(15, 0);
                    this.ctx.lineTo(25, 0);
                    this.ctx.strokeStyle = 'white';
                    this.ctx.lineWidth = 3;
                    this.ctx.stroke();
                    
                    // If this is an interaction NPC, add an indicator
                    if (npc.interactionType !== 'none') {
                        this.ctx.beginPath();
                        this.ctx.arc(0, 0, 28, 0, Math.PI * 2);
                        this.ctx.strokeStyle = npc.interactionType === 'travel' ? 'rgba(0, 255, 255, 0.7)' : 'rgba(255, 0, 255, 0.7)';
                        this.ctx.lineWidth = 2;
                        this.ctx.stroke();
                    }
                    
                    // Draw username above avatar
                    this.ctx.rotate(-npc.direction); // Undo rotation for text
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = '12px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(npc.username, 0, -30);
                    
                    this.ctx.restore();
                });
            },
            
            drawMiniMap: function() {
                // Clear mini-map
                this.miniMapCtx.clearRect(0, 0, this.miniMap.width, this.miniMap.height);
                
                // Draw background
                this.miniMapCtx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                this.miniMapCtx.fillRect(0, 0, this.miniMap.width, this.miniMap.height);
                
                // Draw grid
                this.miniMapCtx.strokeStyle = 'rgba(0, 255, 255, 0.3)';
                this.miniMapCtx.lineWidth = 1;
                
                const gridSize = 20;
                for (let x = 0; x < this.miniMap.width; x += gridSize) {
                    this.miniMapCtx.beginPath();
                    this.miniMapCtx.moveTo(x, 0);
                    this.miniMapCtx.lineTo(x, this.miniMap.height);
                    this.miniMapCtx.stroke();
                }
                
                for (let y = 0; y < this.miniMap.height; y += gridSize) {
                    this.miniMapCtx.beginPath();
                    this.miniMapCtx.moveTo(0, y);
                    this.miniMapCtx.lineTo(this.miniMap.width, y);
                    this.miniMapCtx.stroke();
                }
                
                // Draw NPCs
                this.npcs.forEach(npc => {
                    const miniX = (npc.position.x / this.canvas.width) * this.miniMap.width;
                    const miniY = (npc.position.y / this.canvas.height) * this.miniMap.height;
                    
                    this.miniMapCtx.fillStyle = npc.interactionType === 'travel' ? 'cyan' : (npc.interactionType === 'chat' ? 'magenta' : 'gray');
                    this.miniMapCtx.beginPath();
                    this.miniMapCtx.arc(miniX, miniY, 2, 0, Math.PI * 2);
                    this.miniMapCtx.fill();
                });
                
                // Draw player
                const playerMiniX = (this.player.position.x / this.canvas.width) * this.miniMap.width;
                const playerMiniY = (this.player.position.y / this.canvas.height) * this.miniMap.height;
                
                this.miniMapCtx.fillStyle = 'white';
                this.miniMapCtx.beginPath();
                this.miniMapCtx.arc(playerMiniX, playerMiniY, 4, 0, Math.PI * 2);
                this.miniMapCtx.fill();
                
                // Draw direction
                this.miniMapCtx.strokeStyle = 'white';
                this.miniMapCtx.beginPath();
                this.miniMapCtx.moveTo(playerMiniX, playerMiniY);
                this.miniMapCtx.lineTo(
                    playerMiniX + Math.cos(this.player.direction) * 8,
                    playerMiniY + Math.sin(this.player.direction) * 8
                );
                this.miniMapCtx.stroke();
                
                // Draw interaction points
                if (this.worlds[this.currentWorld] && this.worlds[this.currentWorld].interactionPoints) {
                    this.worlds[this.currentWorld].interactionPoints.forEach(point => {
                        const pointMiniX = (point.x / this.canvas.width) * this.miniMap.width;
                        const pointMiniY = (point.y / this.canvas.height) * this.miniMap.height;
                        
                        this.miniMapCtx.fillStyle = 'yellow';
                        this.miniMapCtx.beginPath();
                        this.miniMapCtx.arc(pointMiniX, pointMiniY, 3, 0, Math.PI * 2);
                        this.miniMapCtx.fill();
                    });
                }
                
                // Draw border
                this.miniMapCtx.strokeStyle = 'rgba(0, 255, 255, 0.8)';
                this.miniMapCtx.lineWidth = 2;
                this.miniMapCtx.strokeRect(0, 0, this.miniMap.width, this.miniMap.height);
            },
            
            checkInteractions: function() {
                // Check for interactions with NPCs
                let interactingWithNPC = false;
                
                this.npcs.forEach(npc => {
                    const dx = npc.position.x - this.player.position.x;
                    const dy = npc.position.y - this.player.position.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 50 && npc.interactionType !== 'none') {
                        interactingWithNPC = true;
                        
                        // Show interaction prompt
                        const interactionPrompt = document.getElementById('interaction-prompt');
                        interactionPrompt.style.display = 'flex';
                        interactionPrompt.querySelector('.interaction-text').textContent = 
                            npc.interactionType === 'travel' ? 'Talk about travel' : 'Chat with ' + npc.username;
                        
                        // Handle interaction on 'E' key press
                        if (this.keys['e']) {
                            if (npc.interactionType === 'travel') {
                                this.ui.toggleTravelModal();
                                this.keys['e'] = false; // Prevent multiple activations
                            } else if (npc.interactionType === 'chat') {
                                this.ui.toggleChat();
                                this.addChatMessage(npc.username, this.getRandomNPCMessage());
                                this.keys['e'] = false;
                            }
                        }
                    }
                });
                
                // Check for world interaction points
                if (this.worlds[this.currentWorld] && this.worlds[this.currentWorld].interactionPoints) {
                    this.worlds[this.currentWorld].interactionPoints.forEach(point => {
                        const dx = point.x - this.player.position.x;
                        const dy = point.y - this.player.position.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 50) {
                            interactingWithNPC = true;
                            
                            // Show interaction prompt
                            const interactionPrompt = document.getElementById('interaction-prompt');
                            interactionPrompt.style.display = 'flex';
                            interactionPrompt.querySelector('.interaction-text').textContent = point.text || 'Interact';
                            
                            // Handle interaction on 'E' key press
                            if (this.keys['e']) {
                                if (point.action === 'travel') {
                                    this.ui.toggleTravelModal();
                                } else if (point.action === 'arcade') {
                                    if (this.worlds['arcade-zone']) {
                                        this.worlds['arcade-zone'].startMiniGame(point.gameId);
                                    }
                                }
                                this.keys['e'] = false; // Prevent multiple activations
                            }
                        }
                    });
                }
                
                // Hide interaction prompt if not interacting
                if (!interactingWithNPC) {
                    document.getElementById('interaction-prompt').style.display = 'none';
                }
            },
            
            sendChatMessage: function() {
                const input = document.getElementById('chat-input');
                const message = input.value.trim();
                
                if (message) {
                    this.addChatMessage(this.player.username, message);
                    input.value = '';
                    
                    // Simulate NPC response after delay
                    if (Math.random() > 0.7) {
                        setTimeout(() => {
                            const responder = this.npcs[Math.floor(Math.random() * this.npcs.length)];
                            this.addChatMessage(responder.username, this.getRandomNPCResponse());
                        }, 1000 + Math.random() * 2000);
                    }
                }
            },
            
            addChatMessage: function(username, message) {
                const chatMessages = document.getElementById('chat-messages');
                const messageElement = document.createElement('div');
                messageElement.className = 'chat-message';
                messageElement.innerHTML = `<span class="chat-user">${username}:</span> ${message}`;
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // If chat is not visible, show an indicator
                if (document.getElementById('chat-container').style.display === 'none') {
                    // Flash the chat inventory icon
                    const chatIcon = document.querySelectorAll('.inventory-slot')[1];
                    chatIcon.style.boxShadow = '0 0 10px #f0f';
                    setTimeout(() => {
                        chatIcon.style.boxShadow = '';
                    }, 1000);
                }
            },
            
            getRandomNPCMessage: function() {
                const messages = [
                    "Hey there! The race track is awesome today!",
                    "Have you tried the new arcade games?",
                    "I'm heading to the Battle Arena, want to join?",
                    "This new avatar cost me 5000 coins!",
                    "Did you hear about the easter egg hidden in Sector 7?",
                    "The castle dungeon is nearly impossible to beat.",
                    "I've been here since the OASIS launched!",
                    "Need any virtual gear? I know a guy...",
                    "The Distracted Globe is having a party tonight!",
                    "Watch out for IOI clan members, they're everywhere."
                ];
                
                return messages[Math.floor(Math.random() * messages.length)];
            },
            
            getRandomNPCResponse: function() {
                const responses = [
                    "Cool! I'll check that out.",
                    "Yeah, I heard about that yesterday.",
                    "No way! That's incredible!",
                    "Are you serious? That's awesome!",
                    "I've been there, it's overrated tbh.",
                    "That's what everyone's talking about!",
                    "Do you have coordinates for that?",
                    "I can show you something even better.",
                    "Let's team up sometime!",
                    "LOL, classic OASIS moment."
                ];
                
                return responses[Math.floor(Math.random() * responses.length)];
            },
            
            resizeCanvas: function() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                
                // If game has started, update player position to center
                if (this.gameStarted) {
                    this.player.position = {
                        x: this.canvas.width / 2,
                        y: this.canvas.height / 2
                    };
                }
            },
            
            checkForMobile: function() {
                if (window.innerWidth < 768) {
                    document.getElementById('mobile-controls').style.display = 'block';
                    this.setupMobileControls();
                }
            },
            
            setupMobileControls: function() {
                const joystick = document.getElementById('joystick');
                const joystickContainer = document.querySelector('.joystick-container');
                let joystickActive = false;
                
                joystickContainer.addEventListener('touchstart', (e) => {
                    joystickActive = true;
                    e.preventDefault();
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (!joystickActive) return;
                    
                    const touch = e.touches[0];
                    const rect = joystickContainer.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    
                    let dx = touch.clientX - centerX;
                    let dy = touch.clientY - centerY;
                    
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const maxRadius = rect.width / 2 - joystick.offsetWidth / 2;
                    
                    if (distance > maxRadius) {
                        dx = dx * maxRadius / distance;
                        dy = dy * maxRadius / distance;
                    }
                    
                    joystick.style.transform = `translate(${dx}px, ${dy}px)`;
                    
                    // Calculate normalized values (-1 to 1)
                    const normX = dx / maxRadius;
                    const normY = dy / maxRadius;
                    
                    // Set keys based on joystick position
                    this.keys['a'] = normX < -0.3;
                    this.keys['d'] = normX > 0.3;
                    this.keys['w'] = normY < -0.3;
                    this.keys['s'] = normY > 0.3;
                    
                    e.preventDefault();
                });
                
                document.addEventListener('touchend', () => {
                    joystickActive = false;
                    joystick.style.transform = 'translate(-50%, -50%)';
                    
                    // Reset keys
                    this.keys['a'] = false;
                    this.keys['d'] = false;
                    this.keys['w'] = false;
                    this.keys['s'] = false;
                });
                
                // Action buttons
                const actionButtons = document.querySelectorAll('.action-button');
                
                actionButtons[0].addEventListener('touchstart', () => {
                    this.keys['e'] = true;
                    setTimeout(() => { this.keys['e'] = false; }, 100);
                });
                
                actionButtons[1].addEventListener('touchstart', () => {
                    this.keys[' '] = true; // Space
                    setTimeout(() => { this.keys[' '] = false; }, 100);
                });
                
                actionButtons[2].addEventListener('touchstart', () => {
                    this.ui.toggleChat();
                });
                
                actionButtons[3].addEventListener('touchstart', () => {
                    this.ui.toggleTravelModal();
                });
            }
        };
        
        // World Manager
        class WorldManager {
            constructor(game) {
                this.game = game;
                this.currentWorld = 'central';
                this.worldHistory = [];
            }
            
            travelToWorld(worldId) {
                if (this.game.worlds[worldId]) {
                    // Add travel effect
                    this.addTravelEffect(() => {
                        this.worldHistory.push(this.currentWorld);
                        this.currentWorld = worldId;
                        this.game.currentWorld = worldId;
                        
                        // Update UI
                        document.getElementById('world-name').textContent = this.getWorldName(worldId);
                        
                        // Reset player position
                        this.game.player.position = {
                            x: this.game.canvas.width / 2,
                            y: this.game.canvas.height / 2
                        };
                        
                        // Add chat notification
                        this.game.addChatMessage('System', `You have traveled to ${this.getWorldName(worldId)}.`);
                        
                        // Update DOM body class for world-specific styling
                        document.body.className = worldId;
                        
                        // Generate world-specific NPCs
                        this.game.npcs = [];
                        this.game.generateNPCs();
                    });
                }
            }
            
            addTravelEffect(callback) {
                const overlay = document.getElementById('world-overlay');
                overlay.style.display = 'block';
                
                // Add some particles or effect to the overlay
                for (let i = 0; i < 50; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.position = 'absolute';
                    particle.style.width = '2px';
                    particle.style.height = '2px';
                    particle.style.background = 'white';
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.top = `${Math.random() * 100}%`;
                    particle.style.boxShadow = '0 0 10px white';
                    particle.style.transition = 'all 1s';
                    
                    overlay.appendChild(particle);
                    
                    setTimeout(() => {
                        particle.style.transform = `translate(${(Math.random() - 0.5) * 300}px, ${(Math.random() - 0.5) * 300}px) scale(20)`;
                        particle.style.opacity = '0';
                    }, 10);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 1000);
                }
                
                setTimeout(() => {
                    overlay.style.display = 'none';
                    if (callback) callback();
                }, 1000);
            }
            
            getWorldName(worldId) {
                switch(worldId) {
                    case 'central': return 'Central OASIS';
                    case 'race-track': return 'The Race Track';
                    case 'social-hub': return 'Social Hub';
                    case 'arcade-zone': return 'Arcade Zone';
                    case 'battle-arena': return 'Battle Arena';
                    case 'fantasy-realm': return 'Fantasy Realm';
                    case 'space-sector': return 'Space Sector';
                    default: return worldId.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                }
            }
        }
        
        // UI Manager
        class UIManager {
            constructor(game) {
                this.game = game;
            }
            
            init() {
                // Initialize UI elements
                this.updatePlayerInfo();
                this.setupInventoryInteraction();
            }
            
            update(deltaTime) {
                // Update UI elements that need animation
                this.pulseElements(deltaTime);
                this.updateOnlineUsers();
            }
            
            updatePlayerInfo() {
                document.getElementById('player-name').textContent = this.game.player.username;
            }
            
            setupInventoryInteraction() {
                const inventorySlots = document.querySelectorAll('.inventory-slot');
                
                inventorySlots.forEach((slot, index) => {
                    slot.addEventListener('click', () => {
                        // Remove active class from all slots
                        inventorySlots.forEach(s => s.classList.remove('active'));
                        
                        // Add active class to clicked slot
                        slot.classList.add('active');
                        
                        // Handle inventory item activation
                        switch(index) {
                            case 0: // Travel Pass
                                this.toggleTravelModal();
                                break;
                            case 1: // Communication Device
                                this.toggleChat();
                                break;
                            case 2: // Game Controller
                                if (this.game.currentWorld === 'arcade-zone' && this.game.worlds['arcade-zone']) {
                                    this.game.worlds['arcade-zone'].startMiniGame('random');
                                } else {
                                    this.game.addChatMessage('System', 'Game controller can only be used in the Arcade Zone.');
                                }
                                break;
                            case 3: // Currency
                                this.showCurrencyInfo();
                                break;
                            case 4: // Power-Up
                                this.activatePowerUp();
                                break;
                        }
                    });
                });
            }
            
            toggleTravelModal() {
                const modal = document.getElementById('travel-modal');
                const overlay = document.getElementById('world-overlay');
                
                if (modal.style.display === 'block') {
                    modal.style.display = 'none';
                    overlay.style.display = 'none';
                } else {
                    modal.style.display = 'block';
                    overlay.style.display = 'block';
                }
            }
            
            toggleChat() {
                const chat = document.getElementById('chat-container');
                
                if (chat.style.display === 'flex') {
                    chat.style.display = 'none';
                } else {
                    chat.style.display = 'flex';
                    document.getElementById('chat-input').focus();
                }
            }
            
            showCurrencyInfo() {
                this.game.addChatMessage('System', 'You have 10,000 OASIS Coins.');
            }
            
            activatePowerUp() {
                // Apply a temporary speed boost
                const originalSpeed = this.game.player.speed;
                this.game.player.speed *= 2;
                
                // Add visual effect
                const playerAvatar = document.getElementById('player-avatar');
                playerAvatar.style.boxShadow = '0 0 20px #ff0';
                
                // Add chat notification
                this.game.addChatMessage('System', 'Speed boost activated for 10 seconds!');
                
                // Reset after duration
                setTimeout(() => {
                    this.game.player.speed = originalSpeed;
                    playerAvatar.style.boxShadow = '';
                    this.game.addChatMessage('System', 'Speed boost has ended.');
                }, 10000);
            }
            
            pulseElements(deltaTime) {
                // Add subtle animations to UI elements
                const elements = document.querySelectorAll('.ui-element');
                elements.forEach(element => {
                    if (Math.random() < 0.005) {
                        element.classList.add('glitch');
                        setTimeout(() => {
                            element.classList.remove('glitch');
                        }, 300);
                    }
                });
            }
            
            updateOnlineUsers() {
                // Simulate fluctuating online user count
                if (Math.random() < 0.1) {
                    const currentUsers = parseInt(document.getElementById('online-users').textContent.replace(',', ''));
                    const change = Math.floor(Math.random() * 10) - 5;
                    const newUsers = Math.max(1000, currentUsers + change);
                    document.getElementById('online-users').textContent = newUsers.toLocaleString();
                }
            }
        }
        
        // Avatar System
        class AvatarSystem {
            constructor(game) {
                this.game = game;
                this.canvas = null;
                this.ctx = null;
            }
            
            initAvatarCreator() {
                this.canvas = document.getElementById('avatar-preview-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.updateAvatarPreview();
                
                // Set initial active selections
                document.querySelector(`.body-type[data-type="${this.game.player.avatar.type}"]`).classList.add('active');
                document.querySelector(`.skin-tone[data-color="${this.game.player.avatar.skinTone}"]`).classList.add('active');
                document.querySelector(`.hair-style[data-style="${this.game.player.avatar.hairStyle}"]`).classList.add('active');
                document.querySelector(`.outfit[data-outfit="${this.game.player.avatar.outfit}"]`).classList.add('active');
            }
            
            updateAvatarPreview() {
                if (!this.ctx) return;
                
                // Clear canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw background
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                // Draw avatar body
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY - 50, 40, 0, Math.PI * 2);
                this.ctx.fillStyle = this.game.player.avatar.skinTone;
                this.ctx.fill();
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // Draw body type specific features
                switch(this.game.player.avatar.type) {
                    case 'human':
                        // Standard human features
                        break;
                    case 'robot':
                        // Add robot features
                        this.ctx.strokeStyle = 'rgba(0, 255, 255, 0.8)';
                        this.ctx.lineWidth = 3;
                        this.ctx.beginPath();
                        this.ctx.arc(centerX, centerY - 50, 45, 0, Math.PI * 2);
                        this.ctx.stroke();
                        
                        // Robot eyes
                        this.ctx.fillStyle = 'rgba(0, 255, 255, 0.8)';
                        this.ctx.beginPath();
                        this.ctx.arc(centerX - 15, centerY - 55, 5, 0, Math.PI * 2);
                        this.ctx.arc(centerX + 15, centerY - 55, 5, 0, Math.PI * 2);
                        this.ctx.fill();
                        break;
                    case 'alien':
                        // Add alien features - elongated head
                        this.ctx.beginPath();
                        this.ctx.ellipse(centerX, centerY - 60, 25, 50, 0, 0, Math.PI * 2);
                        this.ctx.fillStyle = this.game.player.avatar.skinTone;
                        this.ctx.fill();
                        this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                        this.ctx.lineWidth = 2;
                        this.ctx.stroke();
                        
                        // Alien eyes
                        this.ctx.fillStyle = 'black';
                        this.ctx.beginPath();
                        this.ctx.ellipse(centerX - 10, centerY - 55, 8, 12, Math.PI / 4, 0, Math.PI * 2);
                        this.ctx.ellipse(centerX + 10, centerY - 55, 8, 12, -Math.PI / 4, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        this.ctx.fillStyle = 'white';
                        this.ctx.beginPath();
                        this.ctx.arc(centerX - 8, centerY - 57, 3, 0, Math.PI * 2);
                        this.ctx.arc(centerX + 12, centerY - 57, 3, 0, Math.PI * 2);
                        this.ctx.fill();
                        break;
                    case 'fantasy':
                        // Add fantasy features like elf ears and glowing aura
                        this.ctx.beginPath();
                        this.ctx.moveTo(centerX - 35, centerY - 60);
                        this.ctx.lineTo(centerX - 50, centerY - 80);
                        this.ctx.lineTo(centerX - 30, centerY - 50);
                        this.ctx.fillStyle = this.game.player.avatar.skinTone;
                        this.ctx.fill();
                        this.ctx.stroke();
                        
                        this.ctx.beginPath();
                        this.ctx.moveTo(centerX + 35, centerY - 60);
                        this.ctx.lineTo(centerX + 50, centerY - 80);
                        this.ctx.lineTo(centerX + 30, centerY - 50);
                        this.ctx.fillStyle = this.game.player.avatar.skinTone;
                        this.ctx.fill();
                        this.ctx.stroke();
                        
                        // Glowing aura
                        const gradient = this.ctx.createRadialGradient(
                            centerX, centerY, 40,
                            centerX, centerY, 100
                        );
                        gradient.addColorStop(0, 'rgba(255, 255, 0, 0.3)');
                        gradient.addColorStop(1, 'rgba(255, 255, 0, 0)');
                        
                        this.ctx.fillStyle = gradient;
                        this.ctx.fillRect(centerX - 100, centerY - 100, 200, 200);
                        break;
                }
                
                // Draw hair based on style
                switch(this.game.player.avatar.hairStyle) {
                    case 'short':
                        this.ctx.fillStyle = '#333';
                        this.ctx.beginPath();
                        this.ctx.arc(centerX, centerY - 80, 25, 0, Math.PI, true);
                        this.ctx.fill();
                        break;
                    case 'long':
                        this.ctx.fillStyle = '#333';
                        this.ctx.beginPath();
                        this.ctx.moveTo(centerX - 40, centerY - 50);
                        this.ctx.lineTo(centerX - 30, centerY + 50);
                        this.ctx.lineTo(centerX + 30, centerY + 50);
                        this.ctx.lineTo(centerX + 40, centerY - 50);
                        this.ctx.closePath();
                        this.ctx.fill();
                        break;
                    case 'ponytail':
                        this.ctx.fillStyle = '#333';
                        this.ctx.beginPath();
                        this.ctx.arc(centerX, centerY - 80, 25, 0, Math.PI, true);
                        this.ctx.fill();
                        
                        this.ctx.beginPath();
                        this.ctx.moveTo(centerX, centerY - 70);
                        this.ctx.quadraticCurveTo(
                            centerX + 40, centerY - 20,
                            centerX + 20, centerY + 60
                        );
                        this.ctx.quadraticCurveTo(
                            centerX + 10, centerY + 70,
                            centerX, centerY + 60
                        );
                        this.ctx.quadraticCurveTo(
                            centerX - 10, centerY + 70,
                            centerX - 20, centerY + 60
                        );
                        this.ctx.quadraticCurveTo(
                            centerX - 40, centerY - 20,
                            centerX, centerY - 70
                        );
                        this.ctx.fill();
                        break;
                    case 'bald':
                        // No hair
                        break;
                    case 'mohawk':
                        this.ctx.fillStyle = '#ff00ff';
                        this.ctx.beginPath();
                        this.ctx.moveTo(centerX - 5, centerY - 90);
                        this.ctx.lineTo(centerX, centerY - 120);
                        this.ctx.lineTo(centerX + 5, centerY - 90);
                        this.ctx.closePath();
                        this.ctx.fill();
                        break;
                }
                
                // Draw body/outfit
                let outfitColor;
                switch(this.game.player.avatar.outfit) {
                    case 'casual': outfitColor = '#3366ff'; break;
                    case 'formal': outfitColor = '#000000'; break;
                    case 'warrior': outfitColor = '#993300'; break;
                    case 'sci-fi': outfitColor = '#33ccff'; break;
                    case 'stealth': outfitColor = '#333333'; break;
                    default: outfitColor = '#3366ff';
                }
                
                // Draw body
                this.ctx.beginPath();
                this.ctx.moveTo(centerX - 40, centerY - 10);
                this.ctx.lineTo(centerX - 50, centerY + 100);
                this.ctx.lineTo(centerX + 50, centerY + 100);
                this.ctx.lineTo(centerX + 40, centerY - 10);
                this.ctx.closePath();
                this.ctx.fillStyle = outfitColor;
                this.ctx.fill();
                
                // Draw neck
                this.ctx.beginPath();
                this.ctx.moveTo(centerX - 10, centerY - 10);
                this.ctx.lineTo(centerX - 10, centerY - 30);
                this.ctx.lineTo(centerX + 10, centerY - 30);
                this.ctx.lineTo(centerX + 10, centerY - 10);
                this.ctx.closePath();
                this.ctx.fillStyle = this.game.player.avatar.skinTone;
                this.ctx.fill();
                
                // Draw arms
                this.ctx.beginPath();
                this.ctx.moveTo(centerX - 40, centerY);
                this.ctx.lineTo(centerX - 70, centerY + 50);
                this.ctx.lineTo(centerX - 60, centerY + 60);
                this.ctx.lineTo(centerX - 30, centerY + 20);
                this.ctx.closePath();
                this.ctx.fillStyle = outfitColor;
                this.ctx.fill();
                
                this.ctx.beginPath();
                this.ctx.moveTo(centerX + 40, centerY);
                this.ctx.lineTo(centerX + 70, centerY + 50);
                this.ctx.lineTo(centerX + 60, centerY + 60);
                this.ctx.lineTo(centerX + 30, centerY + 20);
                this.ctx.closePath();
                this.ctx.fillStyle = outfitColor;
                this.ctx.fill();
                
                // Draw hands
                this.ctx.beginPath();
                this.ctx.arc(centerX - 65, centerY + 60, 8, 0, Math.PI * 2);
                this.ctx.fillStyle = this.game.player.avatar.skinTone;
                this.ctx.fill();
                
                this.ctx.beginPath();
                this.ctx.arc(centerX + 65, centerY + 60, 8, 0, Math.PI * 2);
                this.ctx.fillStyle = this.game.player.avatar.skinTone;
                this.ctx.fill();
                
                // Draw legs
                this.ctx.beginPath();
                this.ctx.moveTo(centerX - 30, centerY + 100);
                this.ctx.lineTo(centerX - 40, centerY + 170);
                this.ctx.lineTo(centerX - 10, centerY + 170);
                this.ctx.lineTo(centerX - 10, centerY + 100);
                this.ctx.closePath();
                this.ctx.fillStyle = '#333';
                this.ctx.fill();
                
                this.ctx.beginPath();
                this.ctx.moveTo(centerX + 30, centerY + 100);
                this.ctx.lineTo(centerX + 40, centerY + 170);
                this.ctx.lineTo(centerX + 10, centerY + 170);
                this.ctx.lineTo(centerX + 10, centerY + 100);
                this.ctx.closePath();
                this.ctx.fillStyle = '#333';
                this.ctx.fill();
                
                // Outfit-specific accessories
                switch(this.game.player.avatar.outfit) {
                    case 'warrior':
                        // Draw shield
                        this.ctx.beginPath();
                        this.ctx.moveTo(centerX - 70, centerY + 20);
                        this.ctx.lineTo(centerX - 90, centerY + 20);
                        this.ctx.lineTo(centerX - 100, centerY + 70);
                        this.ctx.lineTo(centerX - 70, centerY + 90);
                        this.ctx.lineTo(centerX - 40, centerY + 70);
                        this.ctx.lineTo(centerX - 50, centerY + 20);
                        this.ctx.closePath();
                        this.ctx.fillStyle = '#cc9900';
                        this.ctx.fill();
                        this.ctx.strokeStyle = '#fff';
                        this.ctx.lineWidth = 2;
                        this.ctx.stroke();
                        break;
                    case 'sci-fi':
                        // Draw futuristic visor
                        this.ctx.beginPath();
                        this.ctx.moveTo(centerX - 30, centerY - 55);
                        this.ctx.quadraticCurveTo(
                            centerX, centerY - 70,
                            centerX + 30, centerY - 55
                        );
                        this.ctx.lineTo(centerX + 30, centerY - 45);
                        this.ctx.quadraticCurveTo(
                            centerX, centerY - 40,
                            centerX - 30, centerY - 45
                        );
                        this.ctx.closePath();
                        this.ctx.fillStyle = 'rgba(0, 255, 255, 0.7)';
                        this.ctx.fill();
                        break;
                    case 'stealth':
                        // Draw ninja mask
                        this.ctx.fillStyle = '#333';
                        this.ctx.beginPath();
                        this.ctx.arc(centerX, centerY - 50, 35, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        // Eye slit
                        this.ctx.fillStyle = 'rgba(255, 0, 0, 0.7)';
                        this.ctx.beginPath();
                        this.ctx.rect(centerX - 20, centerY - 55, 40, 5);
                        this.ctx.fill();
                        break;
                }
                
                // Draw facial features (eyes, mouth)
                if (this.game.player.avatar.type !== 'robot' && 
                    this.game.player.avatar.type !== 'alien' && 
                    this.game.player.avatar.outfit !== 'stealth') {
                    
                    // Eyes
                    this.ctx.fillStyle = 'white';
                    this.ctx.beginPath();
                    this.ctx.arc(centerX - 12, centerY - 55, 5, 0, Math.PI * 2);
                    this.ctx.arc(centerX + 12, centerY - 55, 5, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    this.ctx.fillStyle = 'black';
                    this.ctx.beginPath();
                    this.ctx.arc(centerX - 12, centerY - 55, 2, 0, Math.PI * 2);
                    this.ctx.arc(centerX + 12, centerY - 55, 2, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // Mouth
                    this.ctx.beginPath();
                    this.ctx.moveTo(centerX - 10, centerY - 35);
                    this.ctx.quadraticCurveTo(
                        centerX, centerY - 30,
                        centerX + 10, centerY - 35
                    );
                    this.ctx.strokeStyle = 'black';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }
                
                // Add glow effect for certain types
                if (this.game.player.avatar.type === 'fantasy' || this.game.player.avatar.outfit === 'sci-fi') {
                    this.ctx.strokeStyle = 'rgba(0, 255, 255, 0.5)';
                    this.ctx.lineWidth = 10;
                    this.ctx.beginPath();
                    this.ctx.rect(10, 10, this.canvas.width - 20, this.canvas.height - 20);
                    this.ctx.stroke();
                }
            }
            
            updatePlayerAvatar() {
                // Update player avatar in the UI
                const avatarElement = document.getElementById('player-avatar');
                
                // Clear existing content
                avatarElement.innerHTML = '';
                
                // Set avatar icon based on type
                let icon = 'user';
                switch(this.game.player.avatar.type) {
                    case 'robot': icon = 'robot'; break;
                    case 'alien': icon = 'user-astronaut'; break;
                    case 'fantasy': icon = 'hat-wizard'; break;
                }
                
                avatarElement.innerHTML = `<i class="fas fa-${icon}"></i>`;
                
                // Set background color based on skin tone
                avatarElement.style.backgroundColor = this.game.player.avatar.skinTone;
                
                // Set border color based on outfit
                let outlineColor;
                switch(this.game.player.avatar.outfit) {
                    case 'casual': outlineColor = '#3366ff'; break;
                    case 'formal': outlineColor = '#000000'; break;
                    case 'warrior': outlineColor = '#993300'; break;
                    case 'sci-fi': outlineColor = '#33ccff'; break;
                    case 'stealth': outlineColor = '#333333'; break;
                    default: outlineColor = '#3366ff';
                }
                
                avatarElement.style.borderColor = outlineColor;
            }
        }
        
        // Central World class
        class CentralWorld {
            constructor(game) {
                this.game = game;
                this.gridSize = 50;
                this.interactionPoints = [
                    { x: game.canvas.width * 0.3, y: game.canvas.height * 0.3, text: 'Travel Portal', action: 'travel' },
                    { x: game.canvas.width * 0.7, y: game.canvas.height * 0.3, text: 'Information Kiosk', action: 'info' },
                    { x: game.canvas.width * 0.5, y: game.canvas.height * 0.7, text: 'Arcade Portal', action: 'arcade', gameId: 'pacman' }
                ];
            }
            
            update(deltaTime) {
                // Update world state
            }
            
            render(ctx) {
                // Draw grid
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.2)';
                ctx.lineWidth = 1;
                
                for (let x = 0; x < ctx.canvas.width; x += this.gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, ctx.canvas.height);
                    ctx.stroke();
                }
                
                for (let y = 0; y < ctx.canvas.height; y += this.gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(ctx.canvas.width, y);
                    ctx.stroke();
                }
                
                // Draw central platform
                ctx.fillStyle = 'rgba(0, 50, 80, 0.5)';
                ctx.beginPath();
                ctx.arc(ctx.canvas.width / 2, ctx.canvas.height / 2, 200, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.8)';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(ctx.canvas.width / 2, ctx.canvas.height / 2, 200, 0, Math.PI * 2);
                ctx.stroke();
                
                // Draw OASIS logo
                ctx.fillStyle = 'rgba(0, 255, 255, 0.9)';
                ctx.font = 'bold 50px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('OASIS', ctx.canvas.width / 2, ctx.canvas.height / 2);
                
                // Draw interaction points
                this.interactionPoints.forEach(point => {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 30, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';
                    ctx.fill();
                    ctx.strokeStyle = 'rgba(255, 255, 0, 0.8)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    // Draw icon
                    ctx.fillStyle = 'rgba(255, 255, 0, 0.8)';
                    ctx.font = '20px "Font Awesome 5 Free"';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    let icon = '⭐';
                    if (point.action === 'travel') icon = '🚀';
                    else if (point.action === 'info') icon = 'ℹ️';
                    else if (point.action === 'arcade') icon = '🎮';
                    
                    ctx.fillText(icon, point.x, point.y);
                    
                    // Draw label
                    ctx.fillStyle = 'white';
                    ctx.font = '14px Arial';
                    ctx.fillText(point.text, point.x, point.y + 45);
                });
                
                // Draw animated circles
                const time = performance.now() / 1000;
                for (let i = 0; i < 5; i++) {
                    const radius = 200 + i * 30 + Math.sin(time + i) * 10;
                    ctx.beginPath();
                    ctx.arc(ctx.canvas.width / 2, ctx.canvas.height / 2, radius, 0, Math.PI * 2);
                    ctx.strokeStyle = `rgba(0, 255, 255, ${0.1 - i * 0.02})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
        }
        
        // RaceTrack.js
        const RaceTrack = {
            init: function() {
                // Initialize race track
                return this;
            }
        };
        
        // arcade.js
        const ArcadeManager = {
            init: function() {
                // Initialize arcade
                return this;
            }
        };
        
        // SocialHub.js
        const SocialHub = {
            init: function() {
                this.setupChat();
                return this;
            },
            
            setupChat: function() {
                const chatInput = document.querySelector('.chat-input input');
                const sendButton = document.querySelector('.chat-input button');
                const chatContainer = document.getElementById('chat-container');
                
                const sendMessage = () => {
                    if (chatInput.value.trim() === '') return;
                    
                    const messageElement = document.createElement('div');
                    messageElement.className = 'chat-message sent';
                    
                    const now = new Date();
                    const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                    
                    messageElement.innerHTML = `
                        <div class="message-sender">You</div>
                        <div class="message-content">${chatInput.value}</div>
                        <div class="message-time">${time}</div>
                    `;
                    
                    chatContainer.appendChild(messageElement);
                    chatInput.value = '';
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    
                    // Simulate response after a short delay
                    setTimeout(() => {
                        const responseElement = document.createElement('div');
                        responseElement.className = 'chat-message received';
                        
                        const responses = [
                            { sender: 'Aech', message: 'Cool! Let me know if you want to team up later.' },
                            { sender: 'Art3mis', message: 'I just found a rare item in Sector 7. Anyone want to check it out?' },
                            { sender: 'Daito', message: 'Has anyone solved the latest Halliday riddle?' }
                        ];
                        
                        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                        
                        responseElement.innerHTML = `
                            <div class="message-sender">${randomResponse.sender}</div>
                            <div class="message-content">${randomResponse.message}</div>
                            <div class="message-time">${time}</div>
                        `;
                        
                        chatContainer.appendChild(responseElement);
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }, 1500);
                };
                
                sendButton.addEventListener('click', sendMessage);
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        };
    </script>
</body>
</html>
